# API Integration для фронтенда

## Обзор

Фронтенд приложения теперь интегрирован с бэкенд API для поиска строительных объектов. Приложение может работать как с моковыми данными, так и с реальными данными из API.

## Структура API интеграции

### 1. Типы данных (`src/types/api.ts`)
- `ApiProjectCard` - структура данных проекта из API
- `ApiResponsiblePerson` - ответственные лица из API
- `ApiDocumentLink` - ссылки на документы
- `ApiIndicators` - показатели проекта
- `ApiError` - структура ошибок API

### 2. API клиент (`src/services/api.ts`)
- `ApiClient` - основной класс для работы с API
- `apiClient` - singleton экземпляр клиента
- Методы:
  - `checkHealth()` - проверка состояния API
  - `searchProjects(params)` - поиск проектов
  - `searchByAddress(address)` - поиск по адресу
  - `searchByStatus(status)` - поиск по статусу
  - `searchByPerson(personName)` - поиск по ответственному лицу
  - `searchByYear(year)` - поиск по году

### 3. Хук для работы с API (`src/hooks/useApi.ts`)
- `useApi()` - хук для управления состоянием API
- Возвращает:
  - `data` - данные из API
  - `loading` - состояние загрузки
  - `error` - ошибки API
  - `searchProjects(query)` - функция поиска
  - `checkHealth()` - проверка здоровья API
  - `clearError()` - очистка ошибок

### 4. Конвертеры данных (`src/utils/apiConverters.ts`)
- `convertApiProjectToConstructionObject()` - преобразование API данных в формат фронтенда
- `convertApiProjectsToConstructionObjects()` - массовое преобразование
- `convertResponsiblePerson()` - преобразование ответственных лиц
- `convertIndicators()` - преобразование показателей

### 5. Обновленный основной хук (`src/hooks/useApp.ts`)
- Интеграция с API через `useApi()`
- Автоматический поиск при вводе запроса
- Переключение между моковыми данными и API данными
- Проверка здоровья API при загрузке

## Как это работает

### Поиск
1. Пользователь вводит запрос в поле поиска
2. Если запрос не пустой - выполняется поиск через API
3. Данные из API конвертируются в формат фронтенда
4. Отображается статус загрузки и результаты

### Статус API
- **Загрузка**: Показывается спиннер и статус "Поиск в реальных данных..."
- **Ошибка**: Отображается ошибка с возможностью повтора
- **Успех**: Показывается статус "Данные из API"

### Fallback
- Если API недоступен - используются моковые данные
- Если поиск не дал результатов - показывается сообщение "Объекты не найдены"

## API Endpoints

### Базовый URL
```
http://localhost:8080
```

### Endpoints
- `GET /actuator/health` - проверка состояния API
- `GET /api/v1/projects/search?q={query}` - поиск проектов

### Примеры запросов
```bash
# Поиск по адресу
GET /api/v1/projects/search?q=Москва

# Поиск по статусу
GET /api/v1/projects/search?q=В%20работе

# Поиск по ответственному лицу
GET /api/v1/projects/search?q=Иванов

# Поиск по году
GET /api/v1/projects/search?q=2025
```

## Конфигурация

### Переменные окружения
API клиент использует базовый URL из константы:
```typescript
const API_BASE_URL = 'http://localhost:8080';
```

### Настройка для продакшена
Для изменения URL API отредактируйте файл `src/services/api.ts`:
```typescript
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8080';
```

## Компоненты

### SearchAndFilter
- Отображает статус API
- Показывает индикатор загрузки
- Отображает ошибки API

### ApiStatus
- Компонент для отображения статуса подключения к API
- Показывает состояние: загрузка, ошибка, успех
- Кнопка повтора при ошибке

## Обработка ошибок

### Типы ошибок
1. **Сетевые ошибки** - проблемы с подключением
2. **HTTP ошибки** - ошибки сервера (4xx, 5xx)
3. **Ошибки парсинга** - проблемы с форматом данных

### Обработка
- Все ошибки логируются в консоль
- Пользователю показывается понятное сообщение
- Предоставляется возможность повтора запроса

## Тестирование

### Ручное тестирование
1. Запустите бэкенд: `docker-compose up -d`
2. Запустите фронтенд: `npm run dev`
3. Откройте http://localhost:3000
4. Попробуйте поиск по различным критериям

### Тестовые запросы
- "Москва" - поиск по городу
- "В работе" - поиск по статусу
- "Иванов" - поиск по фамилии
- "2025" - поиск по году

## Troubleshooting

### Проблемы с CORS
Если возникают ошибки CORS, убедитесь что бэкенд настроен для работы с фронтендом.

### Проблемы с подключением
1. Проверьте что бэкенд запущен: `docker-compose ps`
2. Проверьте логи бэкенда: `docker-compose logs backend`
3. Проверьте доступность API: `curl http://localhost:8080/actuator/health`

### Проблемы с данными
1. Проверьте что Elasticsearch содержит данные
2. Проверьте логи парсинга Excel
3. Убедитесь что EXCEL_LINK правильно настроен
