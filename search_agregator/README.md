# Search Agregator

–°–∏—Å—Ç–µ–º–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Sheets –∏ Elasticsearch. –ü—Ä–æ–µ–∫—Ç –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –•–∞–∫–∞—Ç–æ–Ω–∞ FiloHack 2025.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** –∏–∑ Excel/Google Sheets
- **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** —Å Google Sheets
- **Elasticsearch** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** —Å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
search_agregator/
‚îú‚îÄ‚îÄ src/main/java/com/example/search_agregator/
‚îÇ   ‚îú‚îÄ‚îÄ controller/          # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ model/              # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ repository/         # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Elasticsearch
‚îÇ   ‚îú‚îÄ‚îÄ service/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ SearchAgregatorApplication.java
‚îú‚îÄ‚îÄ src/main/resources/
‚îÇ   ‚îî‚îÄ‚îÄ application.yml     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ postman_collection.json # Postman –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ GOOGLE_SHEETS_SETUP.md # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Google Sheets
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Java 17**
- **Spring Boot 3.5.6**
- **Elasticsearch 8.x**
- **Apache POI** (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel)
- **Jackson** (JSON –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- **Lombok** (—É–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞)

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Java 21**
2. **Elasticsearch 8.x** (–∑–∞–ø—É—â–µ–Ω–Ω—ã–π –Ω–∞ `http://localhost:9200`)
3. **Maven** (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `mvnw`)

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone <repository-url>
   cd search_agregator
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   ```bash
   # Windows
   set EXCEL_LINK=https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=xlsx
   
   # Linux/Mac
   export EXCEL_LINK=https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=xlsx
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
   ```bash
   # Windows
   mvnw.cmd spring-boot:run
   
   # Linux/Mac
   ./mvnw spring-boot:run
   ```

4. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞** `http://localhost:8080`

## üìä –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### ProjectCard

```json
{
  "id": "1",
  "title": "–ñ–ö –°–æ–ª–Ω–µ—á–Ω—ã–π",
  "address": "–≥. –ò–∂–µ–≤—Å–∫, —É–ª. –°–æ–ª–Ω–µ—á–Ω–∞—è, –¥. 45",
  "startDate": "2024-01-01",
  "endDate": "2026-12-31",
  "status": "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
  "responsiblePersons": [
    {
      "fio": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "position": "–ì–ò–ü",
      "phone": "+79991234567",
      "email": "ivanov@email.com",
      "description": ""
    }
  ],
  "documentLinks": [
    {
      "documentType": "–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
      "url": "https://example.com/docs"
    }
  ],
  "indicators": {
    "–ü–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏, –º2": {
      "–°–µ–∫—Ü–∏—è ‚Ññ1": "320,89",
      "–°–µ–∫—Ü–∏—è ‚Ññ2": "570,05",
      "total": "890,94"
    }
  }
}
```

## üîç API Endpoints

### –ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
```http
GET /api/v1/projects/search?q={query}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
```http
GET /api/v1/projects
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ ID
```http
GET /api/v1/projects/{id}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
```http
POST /api/v1/projects
Content-Type: application/json

{
  "title": "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",
  "address": "–ê–¥—Ä–µ—Å –ø—Ä–æ–µ–∫—Ç–∞",
  "startDate": "2024-01-01",
  "endDate": "2026-12-31",
  "status": "–í –ø—Ä–æ—Ü–µ—Å—Å–µ",
  "responsiblePersons": [...],
  "documentLinks": [...],
  "indicators": {...}
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```http
DELETE /api/v1/projects/{id}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Postman –∫–æ–ª–ª–µ–∫—Ü–∏—è

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `postman_collection.json` –≤ Postman –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö endpoints.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Postman

- `{{baseUrl}}` = `http://localhost:8080`
- `{{query}}` = –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `{{projectId}}` = ID –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É:**
```http
GET {{baseUrl}}/api/v1/projects/search?q=–ú–æ—Å–∫–≤–∞
```

**–ü–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ç—É—Å—É:**
```http
GET {{baseUrl}}/api/v1/projects/search?q=–í%20—Ä–∞–±–æ—Ç–µ
```

**–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:**
```http
POST {{baseUrl}}/api/v1/projects
Content-Type: application/json

{
  "title": "–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",
  "address": "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, 1",
  "status": "–í –ø—Ä–æ—Ü–µ—Å—Å–µ"
}
```

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ POST –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ Google Sheets.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ `GOOGLE_SHEETS_SETUP.md`
2. –°–æ–∑–¥–∞–π—Ç–µ Google Apps Script
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   set GOOGLE_SHEETS_WEBHOOK_URL=https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
   ```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### application.yml

```yaml
spring:
  elasticsearch:
    uris: http://localhost:9200
  application:
    name: search_agregator

management:
  health:
    elasticsearch:
      enabled: true

spreadsheet:
  link: ${EXCEL_LINK}
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `EXCEL_LINK` - URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel/Google Sheets
- `GOOGLE_SHEETS_WEBHOOK_URL` - URL Google Apps Script –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö

## üìù –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö Excel

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ê–¥—Ä–µ—Å | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è | –°—Ç–∞—Ç—É—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ | –î–æ–∫—É–º–µ–Ω—Ç—ã | –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ |

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü
```
–§–ò–û | –î–æ–ª–∂–Ω–æ—Å—Ç—å | –¢–µ–ª–µ—Ñ–æ–Ω | Email; –§–ò–û2 | –î–æ–ª–∂–Ω–æ—Å—Ç—å2 | –¢–µ–ª–µ—Ñ–æ–Ω2 | Email2
```

### –§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```
–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ | URL; –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞2 | URL2
```

### –§–æ—Ä–º–∞—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π (JSON)
```json
[
  {
    "indicator_name": "–ü–ª–æ—â–∞–¥—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏, –º2",
    "sections": [
      { "number": "–°–µ–∫—Ü–∏—è ‚Ññ1", "amount": "320,89" },
      { "number": "–°–µ–∫—Ü–∏—è ‚Ññ2", "amount": "570,05" }
    ],
    "total": "890,94"
  }
]
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Elasticsearch –Ω–µ –∑–∞–ø—É—â–µ–Ω
```
Error: Connection refused: localhost:9200
```
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ Elasticsearch –Ω–∞ –ø–æ—Ä—Ç—É 9200

### –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
```
Failed to parse indicators JSON
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON –≤ –∫–æ–ª–æ–Ω–∫–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π Excel

### Google Sheets –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```
Warning: Failed to add project to Google Sheets
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `GOOGLE_SHEETS_WEBHOOK_URL`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [postman_collection.json](postman_collection.json) - –ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API

